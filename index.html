<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Claims Submission - Singunion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .form-container {
            padding: 30px;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #FFD700;
            font-size: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .form-group label .required {
            color: #e74c3c;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .month-checkboxes {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .month-checkboxes label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            cursor: pointer;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
            transition: all 0.2s;
        }

        .month-checkboxes label:hover {
            border-color: #FFD700;
        }

        .month-checkboxes input:checked + span {
            color: #333;
            font-weight: 600;
        }

        .month-checkboxes label:has(input:checked) {
            background: #FFF9E6;
            border-color: #FFD700;
        }

        /* Claims Table */
        .claims-table-container {
            overflow-x: auto;
        }

        .claims-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .claims-table th {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-size: 13px;
            font-weight: 600;
        }

        .claims-table th:first-child {
            border-radius: 8px 0 0 0;
        }

        .claims-table th:last-child {
            border-radius: 0 8px 0 0;
        }

        .claims-table td {
            padding: 8px;
            border: 1px solid #e0e0e0;
            background: white;
        }

        .claims-table input,
        .claims-table select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        .claims-table input:focus,
        .claims-table select:focus {
            outline: none;
            border-color: #FFD700;
        }

        .claims-table .sn-cell {
            text-align: center;
            font-weight: 600;
            color: #666;
            width: 50px;
        }

        .claims-table .amount-input {
            text-align: right;
        }

        .file-upload-cell {
            position: relative;
        }

        .file-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .file-input-wrapper input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            padding: 8px 12px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        .file-upload-btn:hover {
            background: linear-gradient(135deg, #2980b9 0%, #1f6dad 100%);
        }

        .file-name {
            font-size: 11px;
            color: #666;
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .remove-row-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
        }

        .remove-row-btn:hover {
            background: #c0392b;
        }

        .add-row-btn {
            margin-top: 15px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .add-row-btn:hover {
            background: linear-gradient(135deg, #1e8449 0%, #196f3d 100%);
        }

        /* Total Section */
        .total-section {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 20px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 8px;
        }

        .total-label {
            color: white;
            font-size: 16px;
            margin-right: 15px;
        }

        .total-amount {
            color: #FFD700;
            font-size: 24px;
            font-weight: 700;
        }

        /* Buttons */
        .button-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-clear {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
        }

        .btn-clear:hover {
            background: linear-gradient(135deg, #7f8c8d 0%, #6c7a7b 100%);
            transform: translateY(-2px);
        }

        .btn-submit {
            background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
            color: #333;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, #FFC107 0%, #FFB300 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 193, 7, 0.4);
        }

        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success Message */
        .success-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .success-overlay.show {
            display: flex;
        }

        .success-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 40px;
            color: white;
        }

        .success-content h2 {
            color: #27ae60;
            margin-bottom: 10px;
        }

        .success-content p {
            color: #666;
            margin-bottom: 20px;
        }

        .claim-id {
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
        }

        .btn-new-claim {
            padding: 12px 30px;
            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .month-checkboxes {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .button-section {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Office Claims Submission</h1>
        </div>

        <form id="claimsForm" class="form-container">
            <!-- Staff Information -->
            <div class="form-section">
                <h3>üë§ Staff Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Staff Name <span class="required">*</span></label>
                        <input type="text" id="staffName" name="staffName" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label>Email Address <span class="required">*</span></label>
                        <input type="email" id="staffEmail" name="staffEmail" required placeholder="your.email@company.com">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Department <span class="required">*</span></label>
                        <select id="department" name="department" required>
                            <option value="">-- Select Department --</option>
                            <option value="Agency / Operations / Boarding">Agency / Operations / Boarding</option>
                            <option value="Account & HR Department">Account & HR Department</option>
                            <option value="Ocean Carriers">Ocean Carriers</option>
                            <option value="Singunion Chartering">Singunion Chartering</option>
                            <option value="Singunion Shipping">Singunion Shipping</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Months Involved -->
            <div class="form-section">
                <h3>üìÖ Month(s) Involved <span class="required">*</span></h3>
                <div class="month-checkboxes" id="monthCheckboxes">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Claims Details -->
            <div class="form-section">
                <h3>üìù Claims Details</h3>
                <div class="claims-table-container">
                    <table class="claims-table" id="claimsTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">S/N</th>
                                <th style="width: 180px;">TYPE OF CLAIMS</th>
                                <th style="width: 120px;">AMOUNT (SGD)</th>
                                <th>REMARKS</th>
                                <th style="width: 150px;">RECEIPT</th>
                                <th style="width: 60px;"></th>
                            </tr>
                        </thead>
                        <tbody id="claimsBody">
                            <!-- Rows will be added by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <button type="button" class="add-row-btn" onclick="addRow()">‚ûï Add Row</button>

                <div class="total-section">
                    <span class="total-label">Total Amount:</span>
                    <span class="total-amount">SGD $<span id="totalAmount">0.00</span></span>
                </div>
            </div>

            <!-- Buttons -->
            <div class="button-section">
                <button type="button" class="btn btn-clear" onclick="clearForm()">üóëÔ∏è Clear Form</button>
                <button type="submit" class="btn btn-submit" id="submitBtn">üì§ Submit Claim</button>
            </div>
        </form>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Submitting your claim...</p>
            <p style="font-size: 12px; color: #999;">Please wait while we upload your files</p>
        </div>
    </div>

    <!-- Success Overlay -->
    <div class="success-overlay" id="successOverlay">
        <div class="success-content">
            <div class="success-icon">‚úì</div>
            <h2>Claim Submitted!</h2>
            <p>Your expense claim has been submitted successfully.</p>
            <div class="claim-id" id="successClaimId">EXP-XXXXXX-XXXXXX</div>
            <p style="font-size: 13px; color: #888;">A confirmation email will be sent to you shortly.</p>
            <button class="btn-new-claim" onclick="startNewClaim()">üìù Submit Another Claim</button>
        </div>
    </div>

    <script>
        // Configuration - UPDATE THIS URL AFTER SETTING UP N8N WEBHOOK
        const WEBHOOK_URL = 'https://ctlee0712.app.n8n.cloud/webhook/claims-submit';

        // Claim types
        const claimTypes = [
            'Transport / Taxi',
            'Meals / Entertainment',
            'Phone / Mobile',
            'Office Supplies'
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateMonthCheckboxes();
            addRow(); // Add first row
            addRow(); // Add second row
            addRow(); // Add third row
        });

        // Generate month checkboxes (current year and next year)
        function generateMonthCheckboxes() {
            const container = document.getElementById('monthCheckboxes');
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            
            // Show last 6 months + current month + next 5 months
            let html = '';
            for (let i = -6; i <= 5; i++) {
                const date = new Date(currentYear, currentDate.getMonth() + i, 1);
                const monthYear = `${months[date.getMonth()]} ${date.getFullYear()}`;
                const value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                const isCurrentMonth = i === 0;
                
                html += `
                    <label>
                        <input type="checkbox" name="months" value="${value}" ${isCurrentMonth ? 'checked' : ''}>
                        <span>${monthYear}</span>
                    </label>
                `;
            }
            container.innerHTML = html;
        }

        // Row counter
        let rowCounter = 0;

        // Add new row
        function addRow() {
            rowCounter++;
            const tbody = document.getElementById('claimsBody');
            
            let typeOptions = '<option value="">-- Select --</option>';
            claimTypes.forEach(type => {
                typeOptions += `<option value="${type}">${type}</option>`;
            });

            const row = document.createElement('tr');
            row.id = `row-${rowCounter}`;
            row.innerHTML = `
                <td class="sn-cell">${rowCounter}</td>
                <td>
                    <select name="claimType[]" required>
                        ${typeOptions}
                    </select>
                </td>
                <td>
                    <input type="number" name="amount[]" class="amount-input" step="0.01" min="0" 
                           placeholder="0.00" onchange="calculateTotal()" onkeyup="calculateTotal()">
                </td>
                <td>
                    <input type="text" name="remarks[]" placeholder="Enter remarks (optional)">
                </td>
                <td class="file-upload-cell">
                    <div class="file-input-wrapper">
                        <input type="file" id="file-${rowCounter}" name="receipt[]" accept="image/*,.pdf" 
                               onchange="updateFileName(${rowCounter})">
                        <button type="button" class="file-upload-btn" onclick="document.getElementById('file-${rowCounter}').click()">
                            üìé Upload
                        </button>
                        <span class="file-name" id="fileName-${rowCounter}">No file</span>
                    </div>
                </td>
                <td>
                    <button type="button" class="remove-row-btn" onclick="removeRow(${rowCounter})">‚úï</button>
                </td>
            `;
            tbody.appendChild(row);
            updateRowNumbers();
        }

        // Remove row
        function removeRow(id) {
            const row = document.getElementById(`row-${id}`);
            if (row && document.querySelectorAll('#claimsBody tr').length > 1) {
                row.remove();
                updateRowNumbers();
                calculateTotal();
            } else {
                alert('You need at least one claim row.');
            }
        }

        // Update row numbers
        function updateRowNumbers() {
            const rows = document.querySelectorAll('#claimsBody tr');
            rows.forEach((row, index) => {
                row.querySelector('.sn-cell').textContent = index + 1;
            });
        }

        // Update file name display
        function updateFileName(id) {
            const input = document.getElementById(`file-${id}`);
            const nameSpan = document.getElementById(`fileName-${id}`);
            if (input.files.length > 0) {
                nameSpan.textContent = input.files[0].name;
                nameSpan.title = input.files[0].name;
            } else {
                nameSpan.textContent = 'No file';
            }
        }

        // Calculate total
        function calculateTotal() {
            const amounts = document.querySelectorAll('input[name="amount[]"]');
            let total = 0;
            amounts.forEach(input => {
                const value = parseFloat(input.value) || 0;
                total += value;
            });
            document.getElementById('totalAmount').textContent = total.toFixed(2);
        }

        // Clear form
        function clearForm() {
            if (confirm('Are you sure you want to clear the form? All data will be lost.')) {
                document.getElementById('claimsForm').reset();
                document.getElementById('claimsBody').innerHTML = '';
                rowCounter = 0;
                addRow();
                addRow();
                addRow();
                generateMonthCheckboxes();
                calculateTotal();
            }
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Form submission
        document.getElementById('claimsForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Validate months
            const selectedMonths = document.querySelectorAll('input[name="months"]:checked');
            if (selectedMonths.length === 0) {
                alert('Please select at least one month.');
                return;
            }

            // Validate at least one claim
            const types = document.querySelectorAll('select[name="claimType[]"]');
            const amounts = document.querySelectorAll('input[name="amount[]"]');
            let hasValidClaim = false;
            
            for (let i = 0; i < types.length; i++) {
                if (types[i].value && amounts[i].value && parseFloat(amounts[i].value) > 0) {
                    hasValidClaim = true;
                    break;
                }
            }

            if (!hasValidClaim) {
                alert('Please enter at least one claim with type and amount.');
                return;
            }

            // Show loading
            document.getElementById('loadingOverlay').classList.add('show');
            document.getElementById('submitBtn').disabled = true;

            try {
                // Gather form data
                const staffName = document.getElementById('staffName').value;
                const staffEmail = document.getElementById('staffEmail').value;
                const department = document.getElementById('department').value;
                
                // Get selected months
                const months = [];
                selectedMonths.forEach(cb => months.push(cb.value));

                // Get claims
                const claims = [];
                const remarks = document.querySelectorAll('input[name="remarks[]"]');
                const files = document.querySelectorAll('input[name="receipt[]"]');

                for (let i = 0; i < types.length; i++) {
                    if (types[i].value && amounts[i].value && parseFloat(amounts[i].value) > 0) {
                        const claim = {
                            type: types[i].value,
                            amount: parseFloat(amounts[i].value),
                            remarks: remarks[i].value || ''
                        };

                        // Handle file upload
                        if (files[i].files.length > 0) {
                            const file = files[i].files[0];
                            claim.fileName = file.name;
                            claim.fileType = file.type;
                            claim.fileData = await fileToBase64(file);
                        }

                        claims.push(claim);
                    }
                }

                // Calculate total
                const totalAmount = claims.reduce((sum, claim) => sum + claim.amount, 0);

                // Prepare payload
                const payload = {
                    staffName,
                    staffEmail,
                    department,
                    months,
                    claims,
                    totalAmount,
                    submitDate: new Date().toISOString()
                };

                // Send to webhook
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                // Hide loading
                document.getElementById('loadingOverlay').classList.remove('show');

                if (result.success) {
                    // Show success
                    document.getElementById('successClaimId').textContent = result.claimId || 'Submitted';
                    document.getElementById('successOverlay').classList.add('show');
                } else {
                    throw new Error(result.message || 'Submission failed');
                }

            } catch (error) {
                document.getElementById('loadingOverlay').classList.remove('show');
                document.getElementById('submitBtn').disabled = false;
                alert('Error submitting claim: ' + error.message + '\n\nPlease try again or contact support.');
                console.error('Submission error:', error);
            }
        });

        // Start new claim
        function startNewClaim() {
            document.getElementById('successOverlay').classList.remove('show');
            document.getElementById('submitBtn').disabled = false;
            clearForm();
        }
    </script>
</body>
</html>
